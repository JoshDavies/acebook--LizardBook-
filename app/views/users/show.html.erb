<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
  </head>
  <body>
    <div class="container" style="padding-top:20px">
      <div class="row">
        <div class="col-12" style="padding-right:25px; margin-bottom:35px">
          <div class="card" style="width: 100%; height:400px">
            <img class="card-img-top" src="https://www.tnaqua.org/images/uploads/blog/Madagascar_Giant_Day_Gecko_002_blog_image.jpg">
            <div class="card-body">
              <h2 class="card-text"><%= @user.full_name %></h2>
            </div>
          </div>
        </div>
      </div>
      <div class="row">

<!-- user information section -->
        <div class="col-4"  style="background-color: rgba(0,0,0,.1); padding-bottom:15px">
          <br><h5 style="text-align:center">Profile Information</h5><br>
          <ul class="list-group list-group-flush">
            <li class="list-group-item"><img src="<%= @user.profile_picture %>" height="150px" style="display:block; margin-left:auto;
            margin-right:auto; width:50%; border-radius:50%; margin-top:15px; margin-bottom:15px"></li>
            <li class="list-group-item"><b>Name:</b> <%= @user.full_name %></li>
            <li class="list-group-item"><b>Username:</b> <%= @user.username %></li>
            <li class="list-group-item"><b>Email:</b> <%= @user.email %></li>
            <li class="list-group-item"><b>Birthday:</b> <%= @user.birthday %></li>
            <li class="list-group-item"><b>Species:</b> <%= @user.lizard_species %></li>
          </ul>
        </div>
        <div class="col-8">

<!-- post on user's wall form -->
          <div class="card">
            <h5 class="card-header">What's on your mind?</h5>
            <div class="card-body">
              <%= render template: "posts/new" %>
            </div>
          </div>

<!-- list of posts -->
          <br><h5 style="padding-left:10px">Recent Posts</h5><br>
          <ul class="list-group list-group-flush">

<!-- post list starts here -->
            <% @posts.reverse.each do |post| %>

              <% if post.receiver_id == @user.id %>
                <!-- this is the html for a single post -->
                <li class="list-group-item">
                  <img class="profilepic" src="<%= post.user.profile_picture %>" width="100" height="100" ><br>
                  <div class="username"><a href="users/<%= post.user.id %>" ><%= post.user.username %></a> <br></div>
                  <p><%= simple_format post.content %></p>
                  <div class="time">
                    <% if post.created_at != post.updated_at %>
                      edited:
                    <% end %>
                    <%= time_ago_in_words(post.updated_at) %> ago<br>
                    <%= post.created_at.strftime("%H:%M %a %e %b %Y") %>
                  </div>
                  <br>
                  <div class="edit-delete">

<!-- like button -->
                    <% @post_id = post.id %>
                    <% unless @like = Like.exists?(post.id, session[:user_id]) %>
                      <%= render template: "likes/new" %>
                    <% else %>
                      <%= link_to 'ðŸ‘Ž', @like, :method => :delete, class: "btn btn-outline-primary" %>
                      <br>
                    <% end %>

<!-- edit and delete controls -->
                    <% session[:path] = request.path %>
                    <% if post.user_id == session[:user_id] && Time.now - post.updated_at < 600 %>
                      <%= link_to "Edit", edit_post_path(post) %> |
                    <% elsif Time.now - post.updated_at < 600 %>
                      <a href="#" onclick="alert('Cant do that, this post does not belong to you!');">Edit</a> |
                    <% else %>
                      Cannot Edit |
                    <% end %>
                    <% if post.user_id == session[:user_id] %>
                      <%= link_to 'Delete', post, :method => :delete, data: {:confirm => "Are you sure?"} %>
                    <% else %>
                      <a href="#" onclick="alert('Cant do that, this post does not belong to you!');">Delete</a>
                    <% end %>
                  </div>

<!-- like information -->
                  LICKS: <%= post.likes.length %>
                  <br>
                  <% unless post.likes.length == 0 %>
                    LICKED BY: <%= post.users.map { |x| x.username }.join(", ") %>
                  <% end %>

<!-- comment section starts here (starts with input box) -->
                  <% @post_id = post.id %>
                  <%= render template: "comments/new" %>

<!-- list of comments for current post -->
                  <ul style="list-style-type:none">
                    <% post.comments.each do |comment| %>
                      <li class="com-div">
                        <%= comment.user.username %>: <b><%= comment.text %></b> <br>
                        <p style="font-size:13px">
                          <% if comment.created_at != comment.updated_at %>
                            edited:
                          <% end %>
                          <%= time_ago_in_words(comment.updated_at) %> ago |
                          <%= comment.created_at.strftime("%H:%M %a %e %b %Y") %> |
                          <% if comment.user.id == session[:user_id] && Time.now - comment.updated_at < 600 %>
                            <%= link_to 'Edit Comment', edit_comment_path(comment)%> |
                          <% elsif Time.now - comment.updated_at < 600 %>
                            <a href="#" onclick="alert('Cant do that, this comment does not belong to you!');">Edit Comment</a> |
                          <% else %>
                            Cannot Edit |
                          <% end %>
                          <% if comment.user.id == session[:user_id] %>
                            <%= link_to 'Delete Comment', comment_path(comment), method: :delete, data: { confirm: 'Are you sure?' } %>
                          <% else %>
                            <a href="#" onclick="alert('Cant do that, this comment does not belong to you!');">Delete Comment</a>
                          <% end %>
                        </p>
                      </li>
                    <% end %>
                  </ul>
                </li>
              <% end %>
<!-- single post html ends above this line -->
            <% end %>
<!-- list of posts ends above this line -->
          </ul>
        </div>
      </div>
    </div>
  </body>
</html>
